module CatpPklccin

// Referencing https://github.com/apple/pkl-pantry/blob/main/packages/basePklProject.pkl

amends "pkl:Project"
import "pkl:reflect"

local myModule = reflect.Module(module)
local ghUri_base = "github.com/TimeTravelPenguin/pkl.catppuccin"
local ghUri_dl = "\(ghUri_base)/releases/download"

local packageName: String =
  findRootModule(reflect.Module(module))
    .relativePathTo(module)
    .last

local function findRootModule(mod: reflect.Module): Module =
  let (supermodule = mod.supermodule)
    if (supermodule == null || !supermodule.isAmend) mod.reflectee
    else findRootModule(supermodule)

package {
  name = packageName
  baseUri = "package://\(ghUri_dl)/\(name)"
  packageZipUrl = "https://\(ghUri_dl)/\(name)@\(version)/\(name)@\(version).zip"
  license = "MIT"
  authors {
    "Phillip Smith <TimeTravelPenguin@gmail.com>"
  }
  description = myModule.docComment
  issueTracker = "https://\(ghUri_base)/issues"
  sourceCode = "https://\(ghUri_base)/tree/\(name)@\(version)/packages/\(name)"
  sourceCodeUrlScheme = "https://\(ghUri_base)/blob/\(name)@\(version)/packages/\(name)%{path}#L%{line}-%{endLine}"
}